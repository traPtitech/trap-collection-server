services:
  collection-server:
    extends:
      file: ../base/compose.yaml
      service: collection-server
    build:
      dockerfile: ./docker/test/Dockerfile
    environment:
      COLLECTION_ENV: development
      FEATURE_V2: true
    volumes:
      - ../../:/go/src/github.com/traPtitech/trap-collection-server
      - ../../tmp/coverage:/tmp/coverage
    working_dir: /go/src/github.com/traPtitech/trap-collection-server
    depends_on:
      s3:
        condition: service_healthy
    command: go test ./src/... -v -coverprofile=/tmp/coverage/coverage.txt -race -vet=off
  mariadb:
    extends:
      file: ../base/compose.yaml
      service: mariadb
  s3:
    extends:
      file: ../base/compose.yaml
      service: s3
