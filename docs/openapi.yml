openapi: 3.0.2
servers:
  - url: '/api'
info:
  description: "traPCollectionのAPI"
  version: "1.0.0"
  title: "traPCollection API"
  contact:
    name: traP
    url: 'https://github.com/traPtitech/trap-collection-server'
paths:
  /oauth2/callback:
    parameters:
      - name: code
        in: query
        required: true
        description: OAuth2.0のcode
        schema:
          type: string
      - name: state
        in: query
        required: true
        description: OAuth2.0のstate
        schema:
          type: string
    get:
      tags:
        - user
      description: OAuthのコールバック
      operationId: callback
      responses:
        200:
          description: 成功
        302:
          description: 失敗時。認証ページへリダイレクト
  /oauth2/generate/code:
    get:
      tags:
        - oauth
      description: OAuthのcode_challengeとかの取得
      operationId: getPkce
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code_challenge:
                    type: string
                  code_challenge_method:
                    type: string
                  client_id:
                    type: string
                  response_type:
                    type: string
        500:
          description: 失敗
  /oauth2/logout:
    post:
      tags:
        - oauth
      description: traP Collectionのログアウト
      operationId: postLogout
      responses:
        200:
          description: 成功
        500:
          description: 失敗
  /users/me:
    get:
      tags:
        - user
      description: 自分の情報の取得
      operationId: getMe
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        500:
          description: 失敗
  /users:
    get:
      tags:
        - user
      description: traQの全ユーザー取得
      operationId: getUsers
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        500:
          description: 失敗
  /games:
    post:
      tags:
        - game
      description: ゲームの追加
      operationId: postGame
      requestBody:
        content:
          text/plain:
            schema:
              $ref: '#/components/schemas/NewGameMeta'
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameMeta'
        500:
          description: 失敗
    get:
      tags:
        - game
      description: ゲーム一覧の取得
      operationId: getGames
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Game'
        500:
          description: 失敗
  /games/info/{gameID}:
    parameters:
      - $ref: '#/components/parameters/gameID'
    get:
      tags:
        - game
      description: ゲーム情報の取得
      operationId: getGame
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        500:
          description: 失敗
    put:
      tags:
        - game
      description: ゲームの情報の修正
      operationId: putGame
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewGameMeta'
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameMeta'
        500:
          description: 失敗
    delete:
      tags:
        - game
      description: ゲームの削除
      operationId: deleteGames
      responses:
        200:
          description: 成功
        500:
          description: 失敗
  /games/{gameID}/image:
    parameters:
      - $ref: '#/components/parameters/gameID'
    put:
      tags:
        - game
      description: ゲームの画像の変更
      operationId: putImage
      requestBody:
        content:
          image/jpeg:
            schema:
              type: string
              format: binary
          image/png:
            schema:
              type: string
              format: binary
      responses:
        200:
          description: 成功
        500:
          description: 失敗
    get:
      tags:
        - game
      description: ゲームの画像の取得
      operationId: getImage
      responses:
        200:
          description: 成功
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
        500:
          description: 失敗
  /games/{gameID}/video:
    parameters:
      - $ref: '#/components/parameters/gameID'
    post:
      tags:
        - game
      description: ゲームの動画の変更
      operationId: postVideo
      requestBody:
        content:
          video/mp4:
            schema:
              type: string
              format: binary
      responses:
        200:
          description: 成功
        500:
          description: 失敗
    get:
      tags:
        - game
      description: ゲームの動画の取得
      operationId: getVideo
      responses:
        200:
          description: 成功
          content:
            video/mp4:
              schema:
                type: string
                format: binary
        500:
          description: 失敗
  /games/maintainer:
    get:
      tags:
        - game
      description: 自分がバージョン更新権限保持者のゲームの取得
      operationId: getMyGames
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Game'
        500:
          description: 失敗
  /games/maintainer/{gameID}:
    parameters:
      - $ref: '#/components/parameters/gameID'
    post:
      tags:
        - game
      description: ゲームのバージョン更新権限保持者の追加
      operationId: postMaintainer
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                description: 権限を与える相手のtraQID（UUID）
                type: string
      responses:
        200:
          description: 成功
        500:
          description: 失敗
    get:
      tags:
        - game
      description: ゲームの管理者の取得
      operationId: getOwner
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      description: traQID（UUID）
                      type: string
                    name:
                      description: traQID（UUIDでない方）
                      type: string
                    role:
                      description: 権限（0:ゲームの更新の権限のみ,1:ゲームの更新と更新権限を持つ使途の追加の権限を持つ）
                      type: integer
        500:
          description: 失敗
  /games/version/{gameID}:
    parameters:
      - $ref: '#/components/parameters/gameID'
    post:
      tags:
        - game
      description: ゲームのバージョンの作成
      operationId: postGameVersion
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewGameVersion'
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameVersion'
        500:
          description: 失敗
    get:
      tags:
        - game
      description: ゲームのバージョン一覧の取得
      operationId: getGameVersion
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GameVersion'
        500:
          description: 失敗
  /games/asset/{gameID}/file:
    post:
      tags:
        - game
      description: ゲームの最新バージョンへのファイルの追加
      operationId: postFile
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/NewGameFile'
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameFile'
        400:
          description: 既に同じタイプのファイルがある
        500:
          description: 失敗
    get:
      tags:
        - game
      description: ゲームの最新バージョンのファイルの取得
      operationId: getGameFile
      parameters:
        - $ref: '#/components/parameters/gameID'
        - name: os
          description: osのパラメーター(mac,windows)
          in: query
          required: true
          schema:
            type: string
      responses:
        200:
          description: 成功
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        500:
          description: 失敗
  /games/asset/{gameID}/url:
    parameters:
      - $ref: '#/components/parameters/gameID'
    post:
      tags:
        - game
      description: ゲームの最新バージョンへのURLの追加
      operationId: postURL
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewGameURL'
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameURL'
        400:
          description: 既に同じタイプのファイルがある
        500:
          description: 失敗
    get:
      tags:
        - game
      description: ゲームの最新バージョンのURLの取得
      operationId: getGameURL
      responses:
        200:
          description: 成功
          content:
            text/plain:
              schema:
                type: string
        500:
          description: 失敗
  /versions:
    post:
      tags:
        - version
      description: 新しいバージョンの作成
      operationId: postVersion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewVersion'
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionMeta'
        500:
          description: 失敗
    get:
      tags:
        - version
      description: バージョン一覧の取得
      operationId: getVersions
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Version'
        500:
          description: 失敗
  /versions/{launcherVersionID}:
    parameters:
      - $ref: '#/components/parameters/launcherVersionID'
    get:
      tags:
        - version
      description: バージョンの詳細情報の取得
      operationId: getVersion
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionDetails'
        500:
          description: 失敗
  /versions/{launcherVersionID}/game:
    parameters:
      - $ref: '#/components/parameters/launcherVersionID'
    post:
      tags:
        - version
      description: バージョンへのゲームの追加
      operationId: postGameToVersion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                description: ゲームのUUID
                type: string
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Version'
        500:
          description: 失敗
  /versions/check:
    get:
      tags:
        - version
      description: ブラウザゲーム以外のゲームのID、MD5、ゲームの種類、更新日の一覧
      operationId: getCheckList
      responses:
        200:
          description: 成功時のレスポンス
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CheckItem'
        500:
          description: 失敗時のレスポンス
  /versions/question:
    get:
      tags:
        - version
      description: 質問の取得
      operationId: getQuestions
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Question'
        500:
          description: 失敗
  /questions:
    post:
      tags:
        - question
      description: 質問を作成
      operationId: postQuestion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/NewQuestion'
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Question'
        500:
          description: 失敗
  /questions/{questionID}:
    parameters:
      - $ref: '#/components/parameters/questionID'
    delete:
      tags:
        - question
      description: 質問の削除
      operationId: deleteQuestion
      responses:
        200:
          description: 成功
        500:
          description: 失敗
  /responses:
    post:
      tags:
        - response
      description: 新しい回答を作成します．
      operationId: postResponse
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewResponse'
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewResponse'
        500:
          description: 失敗
  /responses/{launcherVersionID}:
    parameters:
      - $ref: '#/components/parameters/launcherVersionID'
    get:
      tags:
        - response
      description: 回答の統計情報を取得
      operationId: getResponse
      parameters:
        - name: require
          in: query
          required: false
          description: 指定の要素のみ返す。指定なしではすべての要素を返す。（answer,game,remark）
          schema:
            type: string
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseCalc'
        500:
          description: 失敗
  /seats/{seatID}:
    parameters:
      - $ref: '#/components/parameters/seatID'
    post:
      tags:
        - seat
      description: 着席
      operationId: postSeat
      responses:
        200:
          description: 成功
        500:
          description: 失敗
    delete:
      tags:
        - seat
      description: 離席
      operationId: deleteSeat
      responses:
        200:
          description: 成功
        500:
          description: 失敗
  /seats:
    get:
      tags:
        - seat
      description: 席の状態の取得
      operationId: getSeat
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                description: 状態inの席の一覧を取得します。
                type: array
                items:
                  type: integer
                  description: 埋まっている席のIDの一覧
        500:
          description: 失敗

components:
  parameters:
    launcherVersionID:
      name: launcherVersionID
      in: path
      description: ランチャーのバージョンのID
      required: true
      schema:
        type: integer
    gameID:
      description: ゲームのUUID
      name: gameID
      in: path
      required: true
      schema:
        type: string
    gameVersionID:
      description: ゲームのバージョンのID
      name: gameVersionID
      in: path
      required: true
      schema:
        type: integer
    questionID:
      description: 質問のID
      name: questionID
      in: path
      required: true
      schema:
        type: integer
    responseID:
      description: 回答のUUID
      name: responseID
      in: path
      required: true
      schema:
        type: string
    seatID:
      description: 席のID
      name: seatID
      in: path
      required: true
      schema:
        type: integer
  schemas:
    User:
      description: ユーザー
      type: object
      properties:
        userId:
          description: traQのID（UUID）
          type: string
        name:
          description: traQID（UUIDでない方）
          type: string
    CheckItem:
      type: object
      description: ゲームの更新・破損のチェック用リスト
      properties:
        id:
          type: string
        md5:
          type: string
        type:
          description: ゲームの種類（url,jar,windows,mac）
          type: string
        bodyUpdatedAt:
          description: ゲーム本体の更新日時
          type: string
          format: date-time
        imgUpdatedAt:
          description: 画像の更新日時
          type: string
          format: date-time
        movieUpdatedAt:
          description: 動画の更新日時
          type: string
          format: date-time
    NewGameMeta:
      description: 新しいゲームの名前
      type: string
    GameMeta:
      description: ゲーム名とID
      type: object
      properties:
        id:
          description: 追加されたゲームのUUID
          type: string
        name:
          description: 追加されたゲームの名前
          type: string
        description:
          description: 追加されたゲームの説明
          type: string
        createdAt:
          description: ゲームの追加された時刻
          type: string
          format: date-time
    Game:
      description: ゲーム
      type: object
      properties:
        id:
          description: ゲームのUUID
          type: string
        name:
          description: ゲーム名
          type: string
        createdAt:
          description: ゲームの登録時刻
          type: string
          format: date-time
        version:
          description: ゲームの最新バージョン
          $ref: '#/components/schemas/GameVersion'
    NewGameVersion:
      description: 新しいゲームのバージョン
      type: object
      properties:
        name:
          description: 名前
          type: string
        description:
          description: バージョンの説明
          type: string
    GameVersion:
      description: ゲームのバージョン
      type: object
      properties:
        id:
          description: ID
          type: integer
        name:
          description: 名前
          type: string
        description:
          description: バージョンの説明
          type: string
        createdAt:
          description: 登録時刻
          type: string
          format: date-time
    GameVersionWithAssets:
      description: アセット入のゲームのバージョン
      type: object
      properties:
        id:
          description: ID
          type: integer
        name:
          description: 名前
          type: string
        description:
          description: バージョンの説明
          type: string
        createdAt:
          description: 登録時刻
          type: string
          format: date-time
    NewGameFile:
      description: 新しいゲームのファイル
      type: object
      properties:
        type:
          description: ゲームの種類（jar,windows,mac）
          type: string
        file:
          description: ゲームのファイル
          type: string
          format: binary
    NewGameURL:
      description: 新しいゲームのURL
      type: string
    GameAsset:
      description: ゲームのファイル・URLの情報
      type: object
      properties:
        id:
          description: アセットのID
          type: integer
        type:
          description: ゲームの種類（url,jar,windows,mac）
          type: string
        url:
          description: ゲームのURL（タイプがURL以外のときはなし）
          type: string
    GameFile:
      description: ゲームのファイルの情報
      type: object
      properties:
        id:
          description: アセットのID
          type: integer
        type:
          description: ゲームの種類（jar,windows,mac）
          type: string
    GameURL:
      description: ゲームのURLの情報
      type: object
      properties:
        id:
          description: アセットのID
          type: integer
        url:
          description: ゲームのURL（タイプがURL以外のときはなし）
          type: string
    NewVersion:
      description: 新しいバージョンの名前
      type: string
    Version:
      description: バージョン
      type: object
      properties:
        id:
          description: ID
          type: string
        name:
          description: 名前
          type: string
        games:
          type: array
          items:
            description: 入れるゲームのUUID
            type: string
        createdAt:
          description: 登録時刻
          type: string
          format: date-time
    VersionMeta:
      description: バージョンの簡易的な情報
      type: object
      properties:
        id:
          description: ID
          type: string
        name:
          description: 名前
          type: string
        createdAt:
          description: 登録時刻
          type: string
          format: date-time
    VersionDetails:
      description: バージョン詳細
      type: object
      properties:
        id:
          description: ID
          type: string
        name:
          description: 名前
          type: string
        games:
          type: array
          items:
            description: 入れるゲームのUUID
            type: string
        questions:
          type: array
          items:
            $ref: '#/components/schemas/Question'
        createdAt:
          description: 登録時刻
          type: string
          format: date-time
    NewQuestion:
      description: 新しい質問
      type: object
      properties:
        versionId:
          description: 質問を追加するランチャーのバージョンのID
          type: integer
        type:
          description: 質問の種類（radio,checkbox,text）
          type: string
        content:
          description: 質問文
          type: string
        options:
          description: 選択肢（種類がtextのときはなし）
          type: array
          items:
            type: string
        required:
          description: 回答が必須かどうか
          type: boolean
    Question:
      type: object
      description: 質問
      properties:
        id:
          description: 質問のID
          type: integer
        type:
          description: 質問の種類
          type: string
        content:
          description: 質問文
          type: string
        options:
          description: 選択肢
          type: array
          items:
            type: string
        required:
          description: 回答が必須か
          type: boolean
        createdAt:
          description: 質問の作成時刻
          type: string
          format: date-time
    NewResponse:
      type: object
      description: 新しい回答
      properties:
        id:
          description: クライアントのUUID
          type: string
        answers:
          description: バージョンごとの質問に対する回答
          type: array
          items:
            $ref: '#/components/schemas/Answer'
        gameRatings:
          description: ゲームに対する評価
          type: array
          items:
            $ref: '#/components/schemas/GameRating'
        remark:
          description: 自由記述欄
          type: string
    Response:
      description: 回答
      type: object
      properties:
        id:
          description: クライアントのUUID
          type: string
        answers:
          description: バージョンごとの質問に対する回答
          type: array
          items:
            $ref: '#/components/schemas/Answer'
        gameRatings:
          description: ゲームに対する評価
          type: array
          items:
            $ref: '#/components/schemas/GameRating'
        remark:
          description: 自由記述欄
          type: string
        createdAt:
          description: 回答時刻
          type: string
          format: date-time
    ResponseCalc:
      type: object
      description: 回答
      properties:
        id:
          description: クライアントのUUID
          type: string
        answer:
          $ref: '#/components/schemas/AnswerCalc'
        game:
          $ref: '#/components/schemas/GameCalc'
        remark:
          description: 自由記述欄
          type: array
          items:
            type: string
    Answer:
      type: object
      description: バージョンごとの質問に対する回答
      properties:
        id:
          description: 質問のID
          type: integer
        contents:
          description: 回答の配列（チェックボックスの場合のみ複数）
          type: array
          items:
            type: string
    AnswerCalc:
      type: object
      description: 質問に対する回答の統計
      properties:
        id:
          description: 質問のID
          type: integer
          example: 1
        contents:
          description: それぞれの回答とその回答数
          type: array
          items:
            type: object
            properties:
                answer:
                  type: string
                num:
                  type: integer
    GameRating:
      type: object
      description: ゲームの評価
      properties:
        id:
          description: ゲームのUUID
          type: string
        rate:
          description: 星の数
          maximum: 5
          minimum: 1
          type: number
          format: double
        time:
          description: プレイ時間(ms)
          type: integer
    GameCalc:
      type: object
      description: ゲームの評価の統計
      properties:
        id:
          description: ゲームのUUID
          type: string
        rate:
          description: 星の数
          type: array
          items:
            type: object
            properties:
              star:
                type: integer
              num:
                type: integer
        rateAve:
          description: 星の数の平均
          type: integer
        time:
          description: プレイ時間(ms)の平均
          type: integer
        