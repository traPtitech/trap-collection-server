openapi: 3.0.0
servers:
  - url: '/api'
info:
  description: "traPCollectionのAPI"
  version: "1.0.0"
  title: "traPCollection API"
  contact:
    name: traP
    url: 'https://github.com/traPtitech/trap-collection-server'
paths:
  /check/{versionID}:
    parameters:
      - $ref: '#/components/parameters/versionID'
    get:
      tags:
        - check
      description: "ブラウザゲーム以外のゲームのID,MD5を返します。"
      operationId: getCheckListByVersionID
      responses:
        200:
          description: "成功時のレスポンス"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    md5:
                      type: string
                    type:
                      type: string
                      example: url jar windows mac
                    body_updated_at:
                      description: ゲーム本体の更新日時。
                      type: string
                      format: date-time
                    img_updated_at:
                      description: 画像の更新日時。
                      type: string
                      format: date-time
                    movie_updated_at:
                      description: 動画の更新日時。
                      type: string
                      format: date-time
        500:
          description: "失敗時のレスポンス"
  /game/file/{gameID}:
    parameters:
      - name: "gameID"
        in: "path"
        description: "ゲームのID"
        required: true
        schema:
          type: "string"
    get:
      tags:
        - game
      description: "gameIDで指定されたゲームのZipファイルを返します。"
      operationId: getFileByGameID
      responses:
        200:
          description: "成功時のレスポンス"
          content:
            application/zip:
              schema:
                type: "string"
                format: "binary"
        500:
          description: "失敗時のレスポンス"
    put:
      tags:
        - game
      summary: "ブラウザゲーム以外の更新"
      description: "gameIDで指定されたゲームのZipファイルを更新します。"
      operationId: putFileByGameID
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: string
              format: binary
      responses:
        200:
          description: "成功時のレスポンス"
        500:
          description: "失敗時のレスポンス"
  /game/browser/{gameID}:
    parameters:
      - name: "gameID"
        in: "path"
        description: "ゲームのID"
        required: true
        schema:
          type: "string"
    get:
      tags:
        - game
      description: "gameIDで指定されたゲームのURLを返します。"
      operationId: getURLByGameID
      responses:
        200:
          description: "成功時のレスポンス"
          content:
            application/zip:
              schema:
                type: "string"
                format: "byte"
        500:
          description: "失敗時のレスポンス"
    put:
      tags:
        - game
      description: ブラウザゲームの更新。
      operationId: putURLByGameID
      parameters:
      - name: "gameID"
        in: "path"
        description: "ゲームのID"
        required: true
        schema:
          type: "string"
      requestBody:
        content:
          text/plain:
            schema:
              type: string
      responses:
        200:
          description: "成功時のレスポンス"
        500:
          description: "失敗時のレスポンス"
  /game/{gameID}:
    parameters:
      - name: "gameID"
        in: "path"
        description: "ゲームのID"
        required: true
        schema:
          type: "string"
    get:
      tags:
        - game
      description: 指定したゲームの情報の取得。
      operationId: getGameInfoByGameID
      responses:
        200:
          description: 成功しました。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        500:
          description: 失敗したときのレスポンス。
    put:
      tags:
        - game
      description: "指定されたゲームの名前を変更します。"
      operationId: putGameInfoByGameID
      requestBody:
        content:
          text/plain:
            schema:
              type: string
      responses:
        200:
          description: "成功時のレスポンス"
        500:
          description: "失敗時のレスポンス"
    delete:
      tags:
        - game
      description: "指定したIDのゲームの削除"
      operationId: deleteGameByGameID
      responses:
        200:
          description: "成功した時のレスポンス"
        500:
          description: "失敗した時のレスポンス"
  /game:
    post:
      tags:
        - game
      description: "指定された名前でファイルを保存します。"
      operationId: postGame
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Update'
      responses:
        200:
          description: "成功時のレスポンス"
          content:
            application/json:
              schema:
                type: "string"
                example: "game has uploaded"
        500:
          description: "失敗時のレスポンス"
    get:
      tags:
        - game
      description: "ゲームの一覧を返します。"
      operationId: getGame
      responses:
        200:
          description: "成功時のレスポンス"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Game'
        500:
          description: "失敗時のレスポンス"
  /game/image:
    get:
      tags:
        - game
      description: ゲーム画像のダウンロード。
      operationId: getGameImage
      parameters:
        - name: versionID
          in: query
          description: バージョンのID
          required: false
          schema:
            type: string
        - name: "gameID"
          in: query
          description: "ゲームのID"
          required: false
          schema:
            type: "string"
      responses:
        200:
          description: "成功時のレスポンス"
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
            image/gif:
              schema:
                type: string
                format: binary
        500:
          description: "失敗時のレスポンス"
  /game/image/{gameID}:
    put:
      tags:
        - game
      description: "ゲームの画像ファイルを更新します。"
      operationId: putGameImage
      parameters:
        - name: "gameID"
          in: "path"
          description: "ゲームのID"
          required: true
          schema:
            type: "string"
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: string
              format: binary
      responses:
        200:
          description: "成功時のレスポンス"
        500:
          description: "失敗時のレスポンス"
  /game/movie:
    parameters:
      - name: versionID
        in: query # パラメータをパス内に含める
        description: バージョンのID
        required: false
        schema:
          type: string
      - name: "gameID"
        in: "query"
        description: "ゲームのID"
        required: false
        schema:
          type: "string"
    get:
      tags:
        - game
      description: ゲーム映像のダウンロード。
      operationId: getGameMovie
      responses:
        200:
          description: "成功時のレスポンス"
          content:
            video/mp4:
              schema:
                type: string
                format: binary
        500:
          description: "失敗時のレスポンス"
  /game/movie/{gameID}:
    put:
      tags:
        - game
      description: "ゲームの動画ファイルを更新します。"
      operationId: putGameMovie
      parameters:
        - name: "gameID"
          in: "path"
          description: "ゲームのID"
          required: true
          schema:
            type: "string"
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: string
              format: binary
      responses:
        200:
          description: "成功時のレスポンス"
        500:
          description: "失敗時のレスポンス"
  /game/version/{gameID}:
    parameters:
      - name: "gameID"
        in: "path"
        description: "ゲームのID"
        required: true
        schema:
          type: "string"
    get:
      tags:
        - game
      description: ゲームの更新履歴取得
      operationId: getGameVersion
      responses:
        200:
          description: 成功時のレスポンス。更新日時の配列を返します。
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                  format: date-time
        500:
          description: 失敗時のレスポンス。
  /game/maintainer/{gameID}:
    parameters:
      - name: "gameID"
        in: "path"
        description: "ゲームのID"
        required: true
        schema:
          type: "string"
    put:
      tags:
        - game
      description: 編集権限を与える。
      operationId: putGameMaintainer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              description: 編集権限を追加する人のtraPID。
              type: array
              items:
                type: string
      responses:
        200:
          description: 正常に編集権限を与えられました。
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
        500:
          description: 失敗しました。
  /version:
    post:
      tags:
        - version
      description: 新しいバージョンを作成します。
      operationId: postVersion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewVersion'
      responses:
        '200':
          description: 正常にバージョンを作成できました．作成されたバージョンを返します．
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Version'
        '500':
          description: 正常に作成できませんでした。リクエストが不正です。
    get:
      tags:
        - version
      description: バージョン一覧の取得。
      operationId: getVersions
      responses:
        '200':
          description: 正常にバージョンを取得できました．バージョンの一覧を返します．
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Version'
        '500':
          description: 正常に取得できませんでした。リクエストが不正です。
    put:
      tags:
        - version
      description: バージョンの更新。
      operationId: putVersion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewVersion'
      responses:
        '200':
          description: 正常にバージョンを更新できました．更新されたバージョンを返します．
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Version'
        '500':
          description: 正常に更新できませんでした。リクエストが不正です。
  /question:
    post:
      tags:
        - question
      description: 新しいアンケートを作成します．
      operationId: postQuestionByVersionID
      parameters:
        - name: versionID
          in: query
          description: バージョンのID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/NewQuestion'
      responses:
        '200':
          description: 正常に質問を作成できました．作成された質問を返します．
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Question'
        '400':
          description: 正常に作成できませんでした。リクエストが不正です。
    get:
      tags:
        - question
      description: 質問の取得
      operationId: getQuestionByVersionID
      parameters:
        - name: versionID
          in: query
          description: バージョンのID
          schema:
            type: string
        - name: questionID
          in: query
          description: 質問のID
          schema:
            type: string
      responses:
        '200':
          description: 正常に質問を取得できました．取得した質問を返します．
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Question'
        '400':
          description: 正常に取得できませんでした。リクエストが不正です。
  /question/{questionID}:
    parameters:
      - $ref: '#/components/parameters/questionID'
    put:
      tags:
        - question
      description: 質問を変更します．
      operationId: putQuestionByQuestionID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewQuestion'
      responses:
        '200':
          description: 正常に質問を変更できました．
        '400':
          description: 正常に変更できませんでした。リクエストが不正です。

    delete:
      tags:
        - question
      description: 質問を削除します．
      operationId: deleteQuestionByQuestionID
      parameters:
        - $ref: '#/components/parameters/questionID'
      responses:
        '200':
          description: 正常に質問を削除できました。
        '400':
          description: 正常に削除できませんでした。存在しない質問です。
  /response:
    post:
      tags:
        - response
      description: 新しい回答を作成します．
      operationId: postResponse
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewResponse'
      responses:
        '200':
          description: 正常に回答を作成できました．作成された回答を返します．
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewResponse'
    get:
      tags:
        - response
      description: 回答を取得します
      operationId: getResponse
      responses:
        200:
          description: 正常に回答を取得しました。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response'
  /response/answer:
    get:
      tags:
        - response
      description: 回答を取ってきます。質問に対応する回答がない場合は空の文字列を返します。
      operationId: getAnswer
      responses:
          '200':
            description: 正常に回答を作成できました．作成された回答を返します．
            content:
              application/json:
                schema:
                  type: array
                  items:
                    $ref: '#/components/schemas/AnswerCalc'
          500:
            description: 失敗しました。
  /response/game:
    get:
      tags:
        - response
      description: 回答を取ってきます
      operationId: getGameRating
      responses:
          '200':
            description: 正常に回答を作成できました．作成された回答を返します．
            content:
              application/json:
                schema:
                  type: array
                  items:
                    $ref: '#/components/schemas/AnswerCalc'
          500:
            description: 失敗しました。
  /seat/{seatID}:
    post:
      tags:
        - seat
      description: 席の状態を更新します。
      operationId: postSeat
      parameters:
          - $ref: '#/components/parameters/seatID'
      responses:
        200:
          description: 更新に成功しました。
        500:
          description: 更新に失敗しました。
    delete:
      tags:
        - seat
      description: 席の状態を更新します。
      operationId: deleteSeat
      parameters:
          - $ref: '#/components/parameters/seatID'
      responses:
        200:
          description: 更新に成功しました。
        500:
          description: 更新に失敗しました。
  /seat:
    get:
      tags:
        - seat
      description: 席の状態を取得します。
      operationId: getSeat
      responses:
        200:
          description: 取得に成功しました。
          content:
            application/json:
              schema:
                description: 状態inの席の一覧を取得します。
                type: array
                items:
                  type: string
                  description: 埋まっている席のIDの一覧
        500:
          description: 取得に失敗しました。
components:
  parameters:
    versionID:
      name: versionID
      in: path # パラメータをパス内に含める
      description: バージョンのID
      required: true
      schema:
        type: string

    questionID:
      name: questionID
      in: path
      required: true
      description: |
        質問ID
      schema:
        type: string

    responseID:
      name: responseID
      in: path
      required: true
      description: |
        回答ID
      schema:
        type: string
    
    seatID:
      name: seatID
      in: path
      required: true
      description: |
        席ID
      schema:
        type: string

  schemas:
    Update:
      type: "object"
      description: 新しいゲーム。
      properties:
        name:
          type: "string"
          format: "byte"
        maintainer:
          type: array
          items:
            type: string
        type:
          type: string
        file:
          type: "string"
          format: "binary"
        image:
          type: "string"
          format: "binary"
        movie:
          type: string
          format: binary

    Question:
      type: object
      description: 質問
      properties:
        id:
          type: integer
        type:
          type: string
        content:
          type: string
        choices:
            type: array
            items:
                type: string
        required:
          type: boolean
        created_at:
          type: string
          format: date-time

    NewQuestion:
      type: object
      description: 新しい質問
      properties:
        type:
          type: string
        content:
          type: string
        choices:
          type: array
          items:
            type: string
        required:
          type: boolean

    Response:
      type: object
      description: 回答
      properties:
        id:
          description: クライアントID。UUID。
          type: string
        answer:
          $ref: '#/components/schemas/AnswerResponse'
        game:
          $ref: '#/components/schemas/GameResponse'
        remark:
          description: 自由記述欄。
          type: string

    NewResponse:
      type: object
      description: 新しい回答
      properties:
        id:
          description: クライアントID。UUID。
          type: string
        answer:
          type: array
          items:
            $ref: '#/components/schemas/AnswerResponse'
        game:
          type: array
          items:
            $ref: '#/components/schemas/GameResponse'
        remark:
          description: 自由記述欄。
          type: string

    AnswerResponse:
      type: object
      description: 質問に対する回答
      properties:
        id:
          description: 質問のID
          type: integer
        contents:
          description: 回答の配列。チェックボックスの場合のみ複数。
          type: array
          items:
            type: string

    GameResponse:
      type: object
      description: ゲームの評価
      properties:
        id:
          description: ゲームのID。
          type: string
        rate:
          description: 星の数。
          type: integer
        time:
          description: プレイ時間(ms)。
          type: integer

    ResponseCalc:
      type: object
      description: 回答
      properties:
        id:
          description: クライアントID。UUID。
          type: string
        answer:
          type: array
          items:
            $ref: '#/components/schemas/AnswerCalc'
        game:
          type: array
          items:
            $ref: '#/components/schemas/GameCalc'
        remark:
          description: 自由記述欄。
          type: array
          items:
            type: string

    AnswerCalc:
      type: object
      description: 質問に対する回答
      properties:
        id:
          description: 質問のID
          type: integer
          example: 1
        contents:
          description: 回答の配列。チェックボックスの場合のみ複数。
          type: array
          items:
            type: object
            properties:
                name:
                  type: string
                num:
                  type: integer

    GameCalc:
      type: object
      description: ゲームの評価
      properties:
        id:
          description: ゲームのID。
          type: string
        rate:
          description: 星の数。
          type: array
          items:
            type: object
            properties:
              star:
                type: integer
              num:
                type: integer
        time:
          description: 平均プレイ時間(ms)。
          type: integer
    NewVersion:
      type: object
      description: 新しいバージョン
      properties:
        name:
          description: バージョン名。
          type: string
        game:
          description: ゲーム。
          type: array
          items:
            description: ゲームのID。
            type: string
    Version:
      type: object
      description: 新しいバージョン
      properties:
        id:
          description: ゲームのID。
          type: string
        name:
          description: バージョン名。
          type: string
        game:
          description: ゲーム。
          type: array
          items:
            description: ゲームのID。
            type: string
    Game:
      type: object
      description: ゲーム
      properties:
        id:
          description: ID。
          type: string
        name:
          description: 名前。
          type: string
        admin:
          description: 管理者のtraPID。
          type: string
        maintainer:
          description: 更新できる人のtraPID。
          type: array
          items:
            type: string
        type:
          description: タイプ。
          type: string
        updated_at:
          description: 作成日時。
          type: array
          items:
            type: string
            format: date-time
